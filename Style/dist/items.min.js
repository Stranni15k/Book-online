"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var imagefilms,filmid=10;Handlebars.registerHelper("inc",function(e,t){return parseInt(e)+1});var userid,items=new Map,ItemLine=function(){function r(e,t,n,o,i){_classCallCheck(this,r),this.imgsource=e,this.price=parseInt(t),this.title=n,this.name=o,this.description=i}return _createClass(r,null,[{key:"createFrom",value:function(e){return new r(e.imgsource,e.price,e.title,e.name,e.description)}}]),r}();function loadItemsTable(){console.info("Try to load data"),fetch("http://localhost:8079/lines").then(function(e){return e.json()}).then(function(e){console.info("Loaded"),items.clear();for(var t=0;t<e.length;t++){var n=e[t];items.set(n.id,ItemLine.createFrom(n))}!function(){console.info("Try to draw table");var n=document.querySelector(".books #out");if(null==n)throw"Table is not found";fetch("handlebars/items-table.html").then(function(e){return e.text()}).then(function(e){var t=Handlebars.compile(e);n.innerHTML=t({items:Object.fromEntries(items.entries())}),console.info("Drawn")}).catch(function(e){throw console.error("Error:",e),"Can't render template"})}()}).catch(function(e){throw console.error("Error:",e),"Can't load items"})}function removeItemFromTable(e){if(console.info("Try to remove item"),confirm("Do you really want to remove this item?")){if(!items.has(e))throw"Item with id ["+e+"] is not found";fetch("http://localhost:8079/lines/"+e,{method:"DELETE"}).then(function(){console.info("Removed"),loadItemsTable()}).catch(function(e){throw console.error("Error:",e),"Can't add item"}),fetch("http://localhost:8079/items/"+e,{method:"DELETE"}).then(function(){console.info("Removed"),loadItemsTable()}).catch(function(e){throw console.error("Error:",e),"Can't add item"})}else console.info("Canceled")}function editItemFromTable(e){userid=e,console.log(userid)}function addtoitem(){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(fetch("http://localhost:8079/lines/"+userid));case 2:return t=e.sent,e.next=5,regeneratorRuntime.awrap(t.json());case 5:n=e.sent,document.getElementById("urltoimage").innerHTML=n.imgsource,document.getElementById("namelem").value=n.title,document.getElementById("pricelem").value=n.price,document.getElementById("authorlem").value=n.name,document.getElementById("descriptionlem").value=n.description,document.getElementById("edititem").style.visibility="visible",document.getElementById("butt").style.visibility="hidden";case 13:case"end":return e.stop()}})}function GetDescription(){var t,n,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){console.info("Try to draw table");var e=document.querySelector("#exampleModal1 .modal-dialog .modal-content .modal-header #exampleModal1Label"),t=document.querySelector("#exampleModal1 .modal-dialog .modal-content .modal-body #infodesc");e.innerHTML=n.title,t.innerHTML=n.description},e.next=3,regeneratorRuntime.awrap(fetch("http://localhost:8079/lines/"+userid));case 3:return t=e.sent,e.next=6,regeneratorRuntime.awrap(t.json());case 6:n=e.sent,o();case 8:case"end":return e.stop()}})}function loadItemsSelect(t){fetch("http://localhost:8079/items").then(function(e){return e.json()}).then(function(e){!function(n,o){fetch("handlebars/items-select.html").then(function(e){return e.text()}).then(function(e){var t=Handlebars.compile(e);n.innerHTML+=t({items:o})}).catch(function(e){throw console.log("Error:",e),"Can't load items"})}(t,e)}).catch(function(e){throw console.log("Error:",e),"Can't load items"})}function donwload(e){var t=e.files[0],n=new FileReader;n.readAsDataURL(t),n.onload=function(){imagefilms=n.result}}butt.onclick=function(){var e=document.getElementById("urltoimage").innerHTML=imagefilms,t=document.getElementById("namelem").value,n=document.getElementById("pricelem").value,o=document.getElementById("authorlem").value,i=document.getElementById("descriptionlem").value;filmid+=1;var r={imgsource:e,price:n,title:t,name:o,description:i},l={name:t,id:userid};fetch("http://localhost:8079/lines",{method:"POST",body:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){console.info("Added"),console.log(e),loadItemsTable()}).catch(function(e){throw console.error("Error:",e),"Can't add item"}),fetch("http://localhost:8079/items/",{method:"POST",body:JSON.stringify(l),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){console.info("Added"),console.log(e)}).catch(function(e){throw console.error("Error:",e),"Can't add item"})},edititem.onclick=function(){var t,n,o,i,r,l,a,c,s,m,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(fetch("http://localhost:8079/lines/"+userid));case 2:return t=e.sent,e.next=5,regeneratorRuntime.awrap(t.json());case 5:n=e.sent,null==imagefilms?(o=document.getElementById("urltoimage").innerHTML=n.imgsource,i=document.getElementById("namelem").value,r=document.getElementById("pricelem").value,l=document.getElementById("authorlem").value,a=document.getElementById("descriptionlem").value,c={imgsource:o,price:r,title:i,name:l,description:a},s={name:i,id:filmid},fetch("http://localhost:8079/lines/"+userid,{method:"PUT",headers:{"Content-type":"application/json"},body:JSON.stringify(c)}),fetch("http://localhost:8079/items/"+userid,{method:"PUT",headers:{"Content-type":"application/json"},body:JSON.stringify(s)}),loadItemsTable()):o=document.getElementById("urltoimage").innerHTML=imagefilms,i=document.getElementById("namelem").value,r=document.getElementById("pricelem").value,l=document.getElementById("authorlem").value,a=document.getElementById("descriptionlem").value,m={imgsource:o,price:r,title:i,name:l,description:a},d={name:i,id:filmid},fetch("http://localhost:8079/lines/"+userid,{method:"PUT",headers:{"Content-type":"application/json"},body:JSON.stringify(m)}),fetch("http://localhost:8079/items/"+userid,{method:"PUT",headers:{"Content-type":"application/json"},body:JSON.stringify(d)}),loadItemsTable();case 16:case"end":return e.stop()}})},modalokno.onclick=function(){document.getElementById("butt").style.visibility="visible",document.getElementById("edititem").style.visibility="hidden"},loadItemsSelect(item),loadItemsTable();
//# sourceMappingURL=items.min.js.map
